<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FB & Insta Story Generator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Urdu+Najd+V3&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #00a1b2, #006163);
      color: #fff;
      padding: 60px 30px;
      overflow: hidden;
    }

    h1 {
      text-align: center;
      color: #fff;
      font-size: 48px;
      font-weight: 600;
      margin-bottom: 40px;
    }

    .main-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      max-width: 1920px;
      margin: 0 auto;
    }

    .canvas-box {
      position: relative;
      width: 960px;
      height: 540px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
      border-radius: 20px;
    }

    .bottom-controls {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.8);
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    input[type="text"] {
      padding: 15px;
      font-size: 18px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-family: 'Urdu Najd V3', serif;
      background-color: #fff;
      color: #333;
    }

    button {
      padding: 15px;
      font-size: 18px;
      background-color: #f06d63;
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #d05a50;
    }

    .logo {
      width: 180px;
      height: auto;
      margin: 10px auto;
    }

  </style>
</head>
<body>

  <h1>FB & Insta Story Generator</h1>

  <div class="main-container">
    <div class="canvas-box">
      <canvas id="canvas" width="1920" height="1080"></canvas>
    </div>

    <div class="canvas-box">
      <canvas id="newsCanvas" width="1920" height="1080"></canvas>
    </div>
  </div>

  <div class="bottom-controls">
    <input type="text" id="headlineInput" dir="rtl" placeholder="ہیڈ لائن یہاں لکھیں..." />
    <button id="stretchButton">Fit by Stretch</button>
    <button id="fitLongestSideButton">Fit on Longest Side</button>
    <button id="centerButton">Center Image</button>
    <button id="generateButton">Generate Story</button>
    <button id="downloadCanvasButton">Download Original</button>
    <button id="downloadNewsButton">Download Story</button>
  </div>

  <!-- JS Script Below -->
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const newsCanvas = document.getElementById('newsCanvas');
    const newsCtx = newsCanvas.getContext('2d');
    const headlineInput = document.getElementById('headlineInput');
    const stretchButton = document.getElementById('stretchButton');
    const fitLongestSideButton = document.getElementById('fitLongestSideButton');
    const centerButton = document.getElementById('centerButton');
    const generateButton = document.getElementById('generateButton');
    const downloadCanvasButton = document.getElementById('downloadCanvasButton');
    const downloadNewsButton = document.getElementById('downloadNewsButton');

    const backgroundImage = new Image();
    backgroundImage.src = 'storybg.jpg';

    const logoImage = new Image();
    logoImage.src = 'aaj-logo.png';

    let image = null;
    let offsetX = 0;
    let offsetY = 0;
    let scale = 1;
    let imageCounter = 1;

    const handlePaste = (e) => {
      const items = e.clipboardData.items;
      for (const item of items) {
        if (item.kind === 'file' && item.type.includes('image')) {
          const blob = item.getAsFile();
          const reader = new FileReader();
          reader.onload = (evt) => loadImage(evt.target.result);
          reader.readAsDataURL(blob);
        }
      }
    };

    const loadImage = (src) => {
      image = new Image();
      image.onload = () => fitImageToCanvas();
      image.src = src;
    };

    const fitImageToCanvas = () => {
      if (!image) return;
      const targetWidth = 966;
      const targetHeight = 1202;
      const aspectRatio = image.width / image.height;
      let width, height;

      if (aspectRatio > 1) { // Landscape image
        width = targetWidth;
        height = targetWidth / aspectRatio;
      } else { // Portrait or square image
        height = targetHeight;
        width = targetHeight * aspectRatio;
      }

      offsetX = (canvas.width - width) / 2;
      offsetY = (canvas.height - height) / 2;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(image, offsetX, offsetY, width, height);
    };

    const drawImage = () => {
      if (!image) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(image, offsetX, offsetY, image.width * scale, image.height * scale);
    };

    const fitByStretch = () => {
      if (!image) return;
      offsetX = offsetY = 0;
      const canvasRatio = canvas.width / canvas.height;
      const imageRatio = image.width / image.height;
      if (imageRatio > canvasRatio) {
        scale = canvas.height / image.height;
        offsetX = (canvas.width - image.width * scale) / 2;
      } else {
        scale = canvas.width / image.width;
        offsetY = (canvas.height - image.height * scale) / 2;
      }
      drawImage();
    };

    const fitOnLongestSide = () => {
      if (!image) return;
      offsetX = offsetY = 0;
      scale = image.width > image.height ? canvas.width / image.width : canvas.height / image.height;
      drawImage();
    };

    const centerImage = () => {
      if (!image) return;
      offsetX = (canvas.width - image.width * scale) / 2;
      offsetY = (canvas.height - image.height * scale) / 2;
      drawImage();
    };

    const generateNewsCanvas = () => {
      const headline = headlineInput.value.trim();
      if (!headline) return;
      newsCtx.clearRect(0, 0, newsCanvas.width, newsCanvas.height);
      newsCtx.drawImage(backgroundImage, 0, 0, newsCanvas.width, newsCanvas.height);

      const canvasImage = new Image();
      canvasImage.onload = function () {
        newsCtx.drawImage(canvasImage, 0, 0, newsCanvas.width, newsCanvas.height);
        drawHeadline(newsCtx, headline);
        newsCtx.drawImage(logoImage, newsCanvas.width - 200, 60, 180, 180);
      };
      canvasImage.src = canvas.toDataURL('image/png');
    };

    // Additional helper function to draw headline on the generated story
    const drawHeadline = (ctx, headline) => {
      ctx.font = 'bold 40px Poppins';
      ctx.fillStyle = '#006163';
      ctx.textAlign = 'center';
      ctx.fillText(headline, newsCanvas.width / 2, 100);
    };

    document.addEventListener('paste', handlePaste);
    stretchButton.addEventListener('click', fitByStretch);
    fitLongestSideButton.addEventListener('click', fitOnLongestSide);
    centerButton.addEventListener('click', centerImage);
    generateButton.addEventListener('click', generateNewsCanvas);

    // Save canvas images
    downloadCanvasButton.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'original_story.png';
      link.href = canvas.toDataURL();
      link.click();
    });

    downloadNewsButton.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'generated_story.png';
      link.href = newsCanvas.toDataURL();
      link.click();
    });
  </script>
</body>
</html>
